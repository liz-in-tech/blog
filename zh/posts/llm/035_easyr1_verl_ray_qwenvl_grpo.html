<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.0" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.13" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="alternate" hreflang="en-us" href="https://liz-in-tech.github.io/blog/posts/llm/035_easyr1_verl_ray_qwenvl_grpo.html"><meta property="og:url" content="https://liz-in-tech.github.io/blog/zh/posts/llm/035_easyr1_verl_ray_qwenvl_grpo.html"><meta property="og:site_name" content="Liz"><meta property="og:title" content="EasyR1 + Verl + Ray + QwenVL + GRPO"><meta property="og:description" content="EasyR1 + Verl + Ray + QwenVL + GRPO 背景介绍 GRPO 四个主要步骤 采用 EasyR1 的 GRPO 训练代码实现 实操记录 GRPO 训练细节"><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:locale:alternate" content="en-US"><meta property="og:updated_time" content="2025-04-12T15:21:07.000Z"><meta property="article:author" content="Liz"><meta property="article:tag" content="EasyR1"><meta property="article:tag" content="Verl"><meta property="article:tag" content="Ray"><meta property="article:tag" content="QwenVL"><meta property="article:tag" content="GRPO"><meta property="article:published_time" content="2025-04-12T00:00:00.000Z"><meta property="article:modified_time" content="2025-04-12T15:21:07.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"EasyR1 + Verl + Ray + QwenVL + GRPO","image":[""],"datePublished":"2025-04-12T00:00:00.000Z","dateModified":"2025-04-12T15:21:07.000Z","author":[{"@type":"Person","name":"Liz","url":"https://github.com/liz-in-tech"}]}</script><link rel="icon" herf="/blogger.png"><link rel="icon" href="/blog/blogger.png"><title>EasyR1 + Verl + Ray + QwenVL + GRPO | Liz</title><meta name="description" content="EasyR1 + Verl + Ray + QwenVL + GRPO 背景介绍 GRPO 四个主要步骤 采用 EasyR1 的 GRPO 训练代码实现 实操记录 GRPO 训练细节">
    <link rel="preload" href="/blog/assets/style-m_obra2h.css" as="style"><link rel="stylesheet" href="/blog/assets/style-m_obra2h.css">
    <link rel="modulepreload" href="/blog/assets/app-fhreafr2.js"><link rel="modulepreload" href="/blog/assets/035_easyr1_verl_ray_qwenvl_grpo.html-kiWI_9hC.js"><link rel="modulepreload" href="/blog/assets/035_easyr1_verl_ray_qwenvl_grpo.html-pD2rgdZ_.js"><link rel="modulepreload" href="/blog/assets/035_grpo_four_main_steps-4GJC7mWc.js"><link rel="modulepreload" href="/blog/assets/plugin-vue_export-helper-x3n3nnut.js">
    <link rel="prefetch" href="/blog/assets/index.html-YbPtte5_.js" as="script"><link rel="prefetch" href="/blog/assets/intro.html-CGfhr1vY.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-FUMOuem4.js" as="script"><link rel="prefetch" href="/blog/assets/index.html--TTjrkIy.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-g4Nfr7z1.js" as="script"><link rel="prefetch" href="/blog/assets/intro.html-bitGHKd2.js" as="script"><link rel="prefetch" href="/blog/assets/001_langchain.html-pCFuhYHy.js" as="script"><link rel="prefetch" href="/blog/assets/002_langchain_sourcecode.html-0dULq4fV.js" as="script"><link rel="prefetch" href="/blog/assets/003_streamlit.html-rU-ICBCx.js" as="script"><link rel="prefetch" href="/blog/assets/004_transformer.html-rVimVVvM.js" as="script"><link rel="prefetch" href="/blog/assets/005_llama.html-PPnfWd5A.js" as="script"><link rel="prefetch" href="/blog/assets/006_llm_leaderboard.html-IMCQYiuX.js" as="script"><link rel="prefetch" href="/blog/assets/007_computer_use.html-NXAgxCZc.js" as="script"><link rel="prefetch" href="/blog/assets/008_rag_challenge.html-2XihIpNV.js" as="script"><link rel="prefetch" href="/blog/assets/009_llm_challenge.html-c_OZVW4n.js" as="script"><link rel="prefetch" href="/blog/assets/010_rag_workflow.html-VAQDBYt1.js" as="script"><link rel="prefetch" href="/blog/assets/011_vector_database.html-lYSX4LTx.js" as="script"><link rel="prefetch" href="/blog/assets/012_prompt_engineering.html-YAdmxOen.js" as="script"><link rel="prefetch" href="/blog/assets/013_optimizing_llm.html-6CxOIR84.js" as="script"><link rel="prefetch" href="/blog/assets/014_rag_evaluation.html-GIu-oGwK.js" as="script"><link rel="prefetch" href="/blog/assets/015_fine_tune.html-dGpakwon.js" as="script"><link rel="prefetch" href="/blog/assets/016_multimodal.html-rrs6OqYq.js" as="script"><link rel="prefetch" href="/blog/assets/017_agent_and_multiagent.html-tCPGJV8e.js" as="script"><link rel="prefetch" href="/blog/assets/018_huggingface.html-xa6dHS9r.js" as="script"><link rel="prefetch" href="/blog/assets/019_ollama.html-plb_Orn6.js" as="script"><link rel="prefetch" href="/blog/assets/020_neo4j.html-a2aBhY6q.js" as="script"><link rel="prefetch" href="/blog/assets/021_microsoft_graphrag.html-oPHcVCmi.js" as="script"><link rel="prefetch" href="/blog/assets/022_llamaindex_graphrag.html-h0RgV0s1.js" as="script"><link rel="prefetch" href="/blog/assets/023_agent_framework.html-py7Qkdf7.js" as="script"><link rel="prefetch" href="/blog/assets/024_distribution_and_parallelism.html-CKC7PrZL.js" as="script"><link rel="prefetch" href="/blog/assets/025_distribution_and_parallelism_1.html-beQNseCy.js" as="script"><link rel="prefetch" href="/blog/assets/026_distribution_and_parallelism_2.html-6kfObp4n.js" as="script"><link rel="prefetch" href="/blog/assets/027_distribution_and_parallelism_3.html-jqwUVAB8.js" as="script"><link rel="prefetch" href="/blog/assets/028_distribution_and_parallelism_4.html-P81Mnq7u.js" as="script"><link rel="prefetch" href="/blog/assets/029_unsloth_grpo.html-1JeKlSnS.js" as="script"><link rel="prefetch" href="/blog/assets/030_wandb.html-WMD5mJL9.js" as="script"><link rel="prefetch" href="/blog/assets/031_qlora.html-JOYVOncP.js" as="script"><link rel="prefetch" href="/blog/assets/032_sft_trainer_sourcecode_prepare_model.html-enb0adk5.js" as="script"><link rel="prefetch" href="/blog/assets/033_sft_trainer_sourcecode_prepare_dataset.html-wFcALIHZ.js" as="script"><link rel="prefetch" href="/blog/assets/034_sft_trainer_sourcecode_prepare_train.html-u2AhA8IY.js" as="script"><link rel="prefetch" href="/blog/assets/035_easyr1_verl_ray_qwenvl_grpo.html-skEdJHbT.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-ZDCSnlc1.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-ZYw6WxxA.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-OavE9BET.js" as="script"><link rel="prefetch" href="/blog/assets/001_langchain.html-tEkJTRMy.js" as="script"><link rel="prefetch" href="/blog/assets/002_langchain_sourcecode.html-Cf9F-5tQ.js" as="script"><link rel="prefetch" href="/blog/assets/003_streamlit.html-HjDyRBtK.js" as="script"><link rel="prefetch" href="/blog/assets/004_transformer.html-LcEZruqw.js" as="script"><link rel="prefetch" href="/blog/assets/005_llama.html-RH03PuTh.js" as="script"><link rel="prefetch" href="/blog/assets/006_llm_leaderboard.html-oHc2EEDF.js" as="script"><link rel="prefetch" href="/blog/assets/007_computer_use.html-9uep80On.js" as="script"><link rel="prefetch" href="/blog/assets/008_rag_challenge.html-n6JQ6oC1.js" as="script"><link rel="prefetch" href="/blog/assets/009_llm_challenge.html-xfwZXlYi.js" as="script"><link rel="prefetch" href="/blog/assets/010_rag_workflow.html-bgEctrLI.js" as="script"><link rel="prefetch" href="/blog/assets/011_vector_database.html-1VYu1fJ-.js" as="script"><link rel="prefetch" href="/blog/assets/012_prompt_engineering.html-8v74jdRy.js" as="script"><link rel="prefetch" href="/blog/assets/013_optimizing_llm.html-W-CdR_ck.js" as="script"><link rel="prefetch" href="/blog/assets/014_rag_evaluation.html-QoGrIyLb.js" as="script"><link rel="prefetch" href="/blog/assets/015_fine_tune.html-B8-mxmmH.js" as="script"><link rel="prefetch" href="/blog/assets/016_multimodal.html-wKLzc0PX.js" as="script"><link rel="prefetch" href="/blog/assets/017_agent_and_multiagent.html-oSXpre05.js" as="script"><link rel="prefetch" href="/blog/assets/018_huggingface.html-z4dUNzIp.js" as="script"><link rel="prefetch" href="/blog/assets/019_ollama.html-BEfb0F5v.js" as="script"><link rel="prefetch" href="/blog/assets/020_neo4j.html-Ss2gFNbK.js" as="script"><link rel="prefetch" href="/blog/assets/021_microsoft_graphrag.html-i7xll12O.js" as="script"><link rel="prefetch" href="/blog/assets/022_llamaindex_graphrag.html-SaWe1p9V.js" as="script"><link rel="prefetch" href="/blog/assets/023_agent_framework.html-SPruHtsV.js" as="script"><link rel="prefetch" href="/blog/assets/024_distribution_and_parallelism.html-7h-MA_ID.js" as="script"><link rel="prefetch" href="/blog/assets/025_distribution_and_parallelism_1.html-L8sqluO4.js" as="script"><link rel="prefetch" href="/blog/assets/026_distribution_and_parallelism_2.html-unSOw2um.js" as="script"><link rel="prefetch" href="/blog/assets/027_distribution_and_parallelism_3.html-lLxN0up_.js" as="script"><link rel="prefetch" href="/blog/assets/028_distribution_and_parallelism_4.html-SSQztgH6.js" as="script"><link rel="prefetch" href="/blog/assets/029_unsloth_grpo.html-BWNBotHO.js" as="script"><link rel="prefetch" href="/blog/assets/030_wandb.html-K-PdjuDZ.js" as="script"><link rel="prefetch" href="/blog/assets/031_qlora.html-vUUfqpgA.js" as="script"><link rel="prefetch" href="/blog/assets/032_sft_trainer_sourcecode_prepare_model.html-XpSPvVnv.js" as="script"><link rel="prefetch" href="/blog/assets/033_sft_trainer_sourcecode_prepare_dataset.html-BzsRNUbf.js" as="script"><link rel="prefetch" href="/blog/assets/034_sft_trainer_sourcecode_prepare_train.html-vUbMaPTG.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-wh_dBtOR.js" as="script"><link rel="prefetch" href="/blog/assets/404.html-cxLWDy2T.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-kf4JCRaf.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-RkA-insV.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-4kI_oqSd.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-WhuidxNt.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-OqGkeUA_.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-5GeN-sdD.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-c4Rf4yh1.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-2r0jUs7o.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BSKRXRQc.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-KjTsJ0Hg.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-TteIwMx3.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-g00XXzrL.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-YxbJgo4L.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-3T79Cy0i.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-A5tlQHan.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-04ff5e0O.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-vgZ6rfFh.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-OmipPplE.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-E1KrJL6a.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-oPH9QkTj.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-cHRqZSs8.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-74SU9ZTn.js" as="script"><link rel="prefetch" href="/blog/assets/index.html--iJiA8oX.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-oZPWb_Fc.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-FUIWSLsp.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-5ERWyusD.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Zjn0JNqd.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-jcvPTrgB.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-9t2TsyuQ.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CcLVFNIv.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DVoYOOaL.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-V52ipvRm.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-9If_KW0o.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-df9Mrf2R.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-f9bWoKcO.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-GYH0QUoo.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-JVTfeijx.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-_C1QVNqX.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-L_IXFmna.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-nZWHmXY7.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-x4gPgqE4.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-bWnVyuyA.js" as="script"><link rel="prefetch" href="/blog/assets/index.html--yTU23ka.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-tRnpyzfw.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-7aypos-L.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-1BXcbV1R.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-pu478WKz.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DFi1VhMA.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-7uaSljkV.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BULhD4SJ.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-i7RIA9-O.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-NNpPPGUU.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-6fV7cAWu.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-re_azL6k.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-eDnsjHn0.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-XJjGVcB1.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-LHukpLS7.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-howjHe2f.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DeN_iOWx.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-cnlzR0a7.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-0P_c_pcU.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-dy_CcFmq.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-FzFytZ_p.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-2KSwV7xp.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-F1coElwg.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-ffflqCb9.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-F8ZuLYgH.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-HeYWaFeL.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-xKYeJEc5.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-xB-iS7Ql.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-OEUPqfTV.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-EE4iQI9m.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-g1PUF_BG.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-nUBcs85a.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-9Y3la5Sf.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-wufIFDPM.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-bXZQIxRE.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-wd6ZkEHi.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Xlk0AXmC.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Uv7c7pYa.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-FfZqC9tZ.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-mSPhZxqB.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-51HoKD5A.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Q5_K6Vux.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-jkWPo860.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-kTEqch5G.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-y4iBqBqc.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-ibHhI9SI.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-3hk_s27_.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-QJ9j3Zl2.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-QvWFHL99.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Pefl6i_g.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-dNHrcQzx.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-tITHrBRq.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-r_IMIQdZ.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-FFF0RGO4.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-9IXcskQt.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-ugXEguUy.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-EfbnPEyC.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-RqAc2CyF.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-EMJv9LS_.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-audCXbpk.js" as="script"><link rel="prefetch" href="/blog/assets/intro.html-iazPKFvc.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-IiF5rOAE.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-s1MWs5zb.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-0gOAHI1M.js" as="script"><link rel="prefetch" href="/blog/assets/intro.html-a7q0xplw.js" as="script"><link rel="prefetch" href="/blog/assets/001_langchain.html-fLyfZFNy.js" as="script"><link rel="prefetch" href="/blog/assets/002_langchain_sourcecode.html-lcfvlblT.js" as="script"><link rel="prefetch" href="/blog/assets/003_streamlit.html-9XVn4hG7.js" as="script"><link rel="prefetch" href="/blog/assets/004_transformer.html-MldEJisU.js" as="script"><link rel="prefetch" href="/blog/assets/005_llama.html-JotIN4H6.js" as="script"><link rel="prefetch" href="/blog/assets/006_llm_leaderboard.html-ftDZgbuv.js" as="script"><link rel="prefetch" href="/blog/assets/007_computer_use.html-_SOaoXIJ.js" as="script"><link rel="prefetch" href="/blog/assets/008_rag_challenge.html-FQMsoj9F.js" as="script"><link rel="prefetch" href="/blog/assets/009_llm_challenge.html-P4ks7YlQ.js" as="script"><link rel="prefetch" href="/blog/assets/010_rag_workflow.html-X7ty61I2.js" as="script"><link rel="prefetch" href="/blog/assets/011_vector_database.html-zGLFxZMM.js" as="script"><link rel="prefetch" href="/blog/assets/012_prompt_engineering.html-L-uerkUa.js" as="script"><link rel="prefetch" href="/blog/assets/013_optimizing_llm.html-rK_nJarI.js" as="script"><link rel="prefetch" href="/blog/assets/014_rag_evaluation.html-h2PjDlW2.js" as="script"><link rel="prefetch" href="/blog/assets/015_fine_tune.html-pXMhjfjk.js" as="script"><link rel="prefetch" href="/blog/assets/016_multimodal.html-Y_P-ZviD.js" as="script"><link rel="prefetch" href="/blog/assets/017_agent_and_multiagent.html-FRpgTzpw.js" as="script"><link rel="prefetch" href="/blog/assets/018_huggingface.html-Lbrv1_hh.js" as="script"><link rel="prefetch" href="/blog/assets/019_ollama.html-HVSsbGLd.js" as="script"><link rel="prefetch" href="/blog/assets/020_neo4j.html-I-xhlwfa.js" as="script"><link rel="prefetch" href="/blog/assets/021_microsoft_graphrag.html-JejUP52Z.js" as="script"><link rel="prefetch" href="/blog/assets/022_llamaindex_graphrag.html-8THZ3ZXf.js" as="script"><link rel="prefetch" href="/blog/assets/023_agent_framework.html-NaPUhH2n.js" as="script"><link rel="prefetch" href="/blog/assets/024_distribution_and_parallelism.html-MrqFblUb.js" as="script"><link rel="prefetch" href="/blog/assets/025_distribution_and_parallelism_1.html-FRbzBxPd.js" as="script"><link rel="prefetch" href="/blog/assets/026_distribution_and_parallelism_2.html-crArymng.js" as="script"><link rel="prefetch" href="/blog/assets/027_distribution_and_parallelism_3.html-HL6ppV5Z.js" as="script"><link rel="prefetch" href="/blog/assets/028_distribution_and_parallelism_4.html-R2pSZwso.js" as="script"><link rel="prefetch" href="/blog/assets/029_unsloth_grpo.html-rrqyK4EB.js" as="script"><link rel="prefetch" href="/blog/assets/030_wandb.html-ev9cLPFl.js" as="script"><link rel="prefetch" href="/blog/assets/031_qlora.html-wkGgFpAO.js" as="script"><link rel="prefetch" href="/blog/assets/032_sft_trainer_sourcecode_prepare_model.html-ONYeyuMo.js" as="script"><link rel="prefetch" href="/blog/assets/033_sft_trainer_sourcecode_prepare_dataset.html-vS-BEu-Q.js" as="script"><link rel="prefetch" href="/blog/assets/034_sft_trainer_sourcecode_prepare_train.html-3snPC0oc.js" as="script"><link rel="prefetch" href="/blog/assets/035_easyr1_verl_ray_qwenvl_grpo.html-qPe3BPk8.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-jeDGu325.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-qTRU-epO.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-HAMog-kZ.js" as="script"><link rel="prefetch" href="/blog/assets/001_langchain.html-vHwu-Gdu.js" as="script"><link rel="prefetch" href="/blog/assets/002_langchain_sourcecode.html-5Kg5zwhq.js" as="script"><link rel="prefetch" href="/blog/assets/003_streamlit.html-UZfDpNuH.js" as="script"><link rel="prefetch" href="/blog/assets/004_transformer.html-9rCLIrCW.js" as="script"><link rel="prefetch" href="/blog/assets/005_llama.html-o9keOWX_.js" as="script"><link rel="prefetch" href="/blog/assets/006_llm_leaderboard.html-0C-icPbf.js" as="script"><link rel="prefetch" href="/blog/assets/007_computer_use.html-AF7IFLLR.js" as="script"><link rel="prefetch" href="/blog/assets/008_rag_challenge.html-Wdc8ZXFz.js" as="script"><link rel="prefetch" href="/blog/assets/009_llm_challenge.html-oETeoOel.js" as="script"><link rel="prefetch" href="/blog/assets/010_rag_workflow.html-WIimITHc.js" as="script"><link rel="prefetch" href="/blog/assets/011_vector_database.html-l5jAN2yD.js" as="script"><link rel="prefetch" href="/blog/assets/012_prompt_engineering.html-EhyyjvUQ.js" as="script"><link rel="prefetch" href="/blog/assets/013_optimizing_llm.html-b6_yDWHG.js" as="script"><link rel="prefetch" href="/blog/assets/014_rag_evaluation.html-7mqw_CT7.js" as="script"><link rel="prefetch" href="/blog/assets/015_fine_tune.html-1dIqy9yu.js" as="script"><link rel="prefetch" href="/blog/assets/016_multimodal.html-2SRz3yJq.js" as="script"><link rel="prefetch" href="/blog/assets/017_agent_and_multiagent.html-uBMTUdhY.js" as="script"><link rel="prefetch" href="/blog/assets/018_huggingface.html-JdPAC1m9.js" as="script"><link rel="prefetch" href="/blog/assets/019_ollama.html-ZH52OLWh.js" as="script"><link rel="prefetch" href="/blog/assets/020_neo4j.html-U8OrbSBP.js" as="script"><link rel="prefetch" href="/blog/assets/021_microsoft_graphrag.html-8I1prfqo.js" as="script"><link rel="prefetch" href="/blog/assets/022_llamaindex_graphrag.html-SnpVXk7d.js" as="script"><link rel="prefetch" href="/blog/assets/023_agent_framework.html-i5CyWxJp.js" as="script"><link rel="prefetch" href="/blog/assets/024_distribution_and_parallelism.html-YdPxwCtE.js" as="script"><link rel="prefetch" href="/blog/assets/025_distribution_and_parallelism_1.html-Vr3eDD2D.js" as="script"><link rel="prefetch" href="/blog/assets/026_distribution_and_parallelism_2.html-PLXeWSEq.js" as="script"><link rel="prefetch" href="/blog/assets/027_distribution_and_parallelism_3.html-wFM3nu4_.js" as="script"><link rel="prefetch" href="/blog/assets/028_distribution_and_parallelism_4.html-qRWXSYWn.js" as="script"><link rel="prefetch" href="/blog/assets/029_unsloth_grpo.html-9BRwGviL.js" as="script"><link rel="prefetch" href="/blog/assets/030_wandb.html-TZx63dJx.js" as="script"><link rel="prefetch" href="/blog/assets/031_qlora.html-8j4_eqzR.js" as="script"><link rel="prefetch" href="/blog/assets/032_sft_trainer_sourcecode_prepare_model.html-zVW4hI7n.js" as="script"><link rel="prefetch" href="/blog/assets/033_sft_trainer_sourcecode_prepare_dataset.html-OUvx2NJV.js" as="script"><link rel="prefetch" href="/blog/assets/034_sft_trainer_sourcecode_prepare_train.html-Ge5OJfGN.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-d0iIdbzY.js" as="script"><link rel="prefetch" href="/blog/assets/404.html-M3JmGxK3.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-E0Uf-RlC.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-7wHdrs1i.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-EcyCVZtj.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Q3X9L2Ah.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-83TC2Fa6.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-nP25Euyt.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-32W6FvDn.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-sYekom6k.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-rs5uKoDP.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-kjFr1RO5.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-UCFlmQQm.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-grGBJNqn.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-FNQhDRub.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-IyXAo525.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Jzo4Ak0m.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-gGCluLUS.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-aJKD5I4p.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-zEfjhDr9.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-6-SShSGt.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-O7RMKtRL.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-YPbvgst7.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-xYgA9jV2.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-QVEydgFs.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-9MpwWsOm.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-ENovtbQa.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-xGTvbtVC.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-jqNgp295.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-1eiCcq7t.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-rGAp3AdC.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-mObaOgBd.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-28Sc5fp6.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Ixs0U0vT.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-MTwexMKW.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-L5XvE4xx.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-9QWo5rOH.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-71FHomRy.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-tepPCedT.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-9FtRJ5m-.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-AKRJT-Mn.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-FUzoi1l9.js" as="script"><link rel="prefetch" href="/blog/assets/index.html--iwbU7FI.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-yWoZUzgJ.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-ciSxE38z.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-8wEoS34s.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-IsCUy233.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-pkSgJ2Uo.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Wq3E1Pof.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-ndJQaID-.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-dDblHJh7.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-u-f114yt.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-anaHXJUA.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-luKUnw69.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DPcEgSqB.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-6hiJMlm0.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-3uFDpE1R.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-IDJhmvXH.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-o_8F694j.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Fr_X1u9d.js" as="script"><link rel="prefetch" href="/blog/assets/index.html--2FS6q1j.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-ULjiJGxK.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-N2t2L6oR.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-j2VQON2Y.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-ye80gnUJ.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-WMk8kgcA.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-JSYMqxNA.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-bYrZaj6o.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-_x9lcxtt.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-bqL_mwjT.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-FNK2PNJa.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-V6f348bP.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Kgf7nG8v.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-7DEG08t1.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-83Zz1fx9.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-bZ1eha7I.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Wmo7SLgP.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-orePDJaC.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-F4nQu6qK.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-HE_dj3tq.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-mWgFElb5.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-0VnLh8yX.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-5BJAYyU1.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-X8i0gTxI.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-FTUDpjYh.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-QXASmgWN.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-FDiSZjaM.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-GAs2pC5H.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-ls7GE9sb.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-KXKQ2tyb.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-TVoVPH3q.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-PvDrRjta.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-hH4wJPAx.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-No3R7awb.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-HwYPFCg3.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-HuqoRsiV.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-U9bdqgS4.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-XGXUe0CP.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-drPaA9OS.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-SSXiwV5K.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-QSaelfwt.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-SVLc0mky.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-4FQyfuI4.js" as="script"><link rel="prefetch" href="/blog/assets/photoswipe.esm-08_zHRDQ.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><!--[--><div class="theme-container no-sidebar has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="vp-link vp-brand vp-brand" href="/blog/zh/"><img class="vp-nav-logo" src="/blog/blogger.png" alt><!----><span class="vp-site-name hide-in-pad">Liz</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="nav-item hide-in-mobile"><a aria-label="首页" class="vp-link nav-link nav-link" href="/blog/zh/"><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span>首页<!----></a></div><div class="nav-item hide-in-mobile"><a aria-label="项目" class="vp-link nav-link nav-link" href="/blog/zh/demo/"><span class="font-icon icon fa-fw fa-sm fas fa-star" style=""></span>项目<!----></a></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><div class="nav-item"><div class="dropdown-wrapper i18n-dropdown"><button type="button" class="dropdown-title" aria-label="选择语言"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon i18n-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="i18n icon" style="width:1rem;height:1rem;vertical-align:middle;"><path d="M379.392 460.8 494.08 575.488l-42.496 102.4L307.2 532.48 138.24 701.44l-71.68-72.704L234.496 460.8l-45.056-45.056c-27.136-27.136-51.2-66.56-66.56-108.544h112.64c7.68 14.336 16.896 27.136 26.112 35.84l45.568 46.08 45.056-45.056C382.976 312.32 409.6 247.808 409.6 204.8H0V102.4h256V0h102.4v102.4h256v102.4H512c0 70.144-37.888 161.28-87.04 210.944L378.88 460.8zM576 870.4 512 1024H409.6l256-614.4H768l256 614.4H921.6l-64-153.6H576zM618.496 768h196.608L716.8 532.48 618.496 768z"></path></svg><!--]--><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a aria-label="English" class="vp-link nav-link nav-link" href="/blog/posts/llm/035_easyr1_verl_ray_qwenvl_grpo.html"><!---->English<!----></a></li><li class="dropdown-item"><a aria-label="简体中文" class="vp-link nav-link active nav-link active" href="/blog/zh/posts/llm/035_easyr1_verl_ray_qwenvl_grpo.html"><!---->简体中文<!----></a></li></ul></button></div></div><div class="nav-item vp-repo"><a class="vp-repo-link" href="https://github.com/liz-in-tech" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button type="button" id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><form class="search-box" role="search"><input type="search" placeholder="搜索" autocomplete="off" spellcheck="false" value><!----></form><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!--[--><!----><!--]--><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><span class="font-icon icon fa-fw fa-sm fas fa-lightbulb" style=""></span>EasyR1 + Verl + Ray + QwenVL + GRPO</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://github.com/liz-in-tech" target="_blank" rel="noopener noreferrer">Liz</a></span><span property="author" content="Liz"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2025-04-12T00:00:00.000Z"></span><!----><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 6 分钟</span><meta property="timeRequired" content="PT6M"></span><span class="page-category-info" aria-label="分类🌈" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item category6 clickable" role="navigation">LLM</span><!--]--><meta property="articleSection" content="LLM"></span><span class="page-tag-info" aria-label="标签🏷" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item tag2 clickable" role="navigation">EasyR1</span><span class="page-tag-item tag4 clickable" role="navigation">Verl</span><span class="page-tag-item tag0 clickable" role="navigation">Ray</span><span class="page-tag-item tag3 clickable" role="navigation">QwenVL</span><span class="page-tag-item tag4 clickable" role="navigation">GRPO</span><!--]--><meta property="keywords" content="EasyR1,Verl,Ray,QwenVL,GRPO"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#_1-背景介绍">1. 背景介绍</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#_2-grpo-四个主要步骤-grpo-four-main-steps">2. GRPO 四个主要步骤 GRPO Four Main Steps</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="#_2-1-生成补全序列-generating-completions">2.1. 生成补全序列 Generating completions</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="#_2-2-计算优势值-computing-the-advantage">2.2. 计算优势值 Computing the advantage</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="#_2-3-估计kl散度-estimating-the-kl-divergence">2.3. 估计KL散度 Estimating the KL divergence</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="#_2-4-计算损失-computing-the-loss">2.4. 计算损失 Computing the loss</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#_3-采用-easyr1-的-grpo-训练代码实现">3. 采用 EasyR1 的 GRPO 训练代码实现</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="#_3-1-grpo-训练-examples-qwen2-5-vl-3b-geo3k-grpo-sh">3.1. GRPO 训练：examples/qwen2_5_vl_3b_geo3k_grpo.sh</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="#_3-2-配置文件-examples-config-yaml">3.2. 配置文件：examples/config.yaml</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="#_3-3-入口点-verl-trainer-main-py">3.3. 入口点：verl.trainer.main.py</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="#_3-4-trainer-fit">3.4. trainer.fit()</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#_4-实操记录-grpo-训练细节">4. 实操记录 GRPO 训练细节</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="#_4-1-关键数据信息">4.1. 关键数据信息</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="#_4-2-训练细节">4.2. 训练细节</a></li><!----><!--]--></ul></li><!--]--></ul><div class="toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!--[--><!----><!--]--><div class="theme-hope-content"><h1 id="easyr1-verl-ray-qwenvl-grpo" tabindex="-1"><a class="header-anchor" href="#easyr1-verl-ray-qwenvl-grpo" aria-hidden="true">#</a> EasyR1 + Verl + Ray + QwenVL + GRPO</h1><ul><li>背景介绍</li><li>GRPO 四个主要步骤</li><li>采用 EasyR1 的 GRPO 训练代码实现</li><li>实操记录 GRPO 训练细节</li></ul><!-- more --><h2 id="_1-背景介绍" tabindex="-1"><a class="header-anchor" href="#_1-背景介绍" aria-hidden="true">#</a> 1. 背景介绍</h2><ul><li>EasyR1 <ul><li>https://github.com/hiyouga/EasyR1</li></ul></li><li>Verl <ul><li>https://github.com/volcengine/verl</li></ul></li><li>ray: 分布式计算框架 <ul><li>https://segmentfault.com/a/1190000046195156</li></ul></li><li>GRPO <ul><li>Group Relative Policy Optimization</li><li>grpo_trainer：https://huggingface.co/docs/trl/v0.16.1/grpo_trainer</li></ul></li><li>实验记录 <ul><li>模型：QwenVL <ul><li>https://huggingface.co/Qwen/Qwen2.5-VL-3B-Instruct</li></ul></li><li>数据集：geometry3k <ul><li>https://huggingface.co/datasets/hiyouga/geometry3k</li></ul></li><li>环境：一台8卡A800-80G</li><li>耗时：geometry3k数据集train(2.1k) 训15个episodes,共需8h20min</li></ul></li></ul><h2 id="_2-grpo-四个主要步骤-grpo-four-main-steps" tabindex="-1"><a class="header-anchor" href="#_2-grpo-四个主要步骤-grpo-four-main-steps" aria-hidden="true">#</a> 2. GRPO 四个主要步骤 GRPO Four Main Steps</h2><p>GRPO 四个主要步骤</p><ul><li>生成补全序列 Generating completions</li><li>计算优势值 Computing the advantage</li><li>估计KL散度 Estimating the KL divergence</li><li>计算损失 Computing the loss</li></ul><figure><img src="/blog/assets/035_grpo_four_main_steps-HjwPHvBM.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="_2-1-生成补全序列-generating-completions" tabindex="-1"><a class="header-anchor" href="#_2-1-生成补全序列-generating-completions" aria-hidden="true">#</a> 2.1. 生成补全序列 Generating completions</h3><p>在每个训练步骤中，采样一批提示 prompts，并为每个提示生成一组补全序列 completions（一组有 G 个，每个记为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>o</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">o_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> ）。</p><h3 id="_2-2-计算优势值-computing-the-advantage" tabindex="-1"><a class="header-anchor" href="#_2-2-计算优势值-computing-the-advantage" aria-hidden="true">#</a> 2.2. 计算优势值 Computing the advantage</h3><p>对于每个组的 G 个序列中的每一个使用奖励模型计算奖励 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>r</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">r_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，优势值 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover accent="true"><mi>A</mi><mo>^</mo></mover><mrow><mi>i</mi><mo separator="true">,</mo><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\hat{A}_{i,t}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2329em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9468em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">A</span></span><span style="top:-3.2523em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1111em;"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span> 通过相对比较进行计算，并按以下方式归一化：</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mover accent="true"><mi>A</mi><mo>^</mo></mover><mrow><mi>i</mi><mo separator="true">,</mo><mi>t</mi></mrow></msub><mo>=</mo><mfrac><mrow><msub><mi>r</mi><mi>i</mi></msub><mo>−</mo><mtext>mean</mtext><mo stretchy="false">(</mo><mi>r</mi><mo stretchy="false">)</mo></mrow><mrow><mtext>std</mtext><mo stretchy="false">(</mo><mi>r</mi><mo stretchy="false">)</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex"> \hat{A}_{i,t} = \frac{r_i - \text{mean}(r)}{\text{std}(r)} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2329em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9468em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">A</span></span><span style="top:-3.2523em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1111em;"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.363em;vertical-align:-0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord">std</span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord text"><span class="mord">mean</span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><h3 id="_2-3-估计kl散度-estimating-the-kl-divergence" tabindex="-1"><a class="header-anchor" href="#_2-3-估计kl散度-estimating-the-kl-divergence" aria-hidden="true">#</a> 2.3. 估计KL散度 Estimating the KL divergence</h3><p>KL散度使用 Schulman 等人（2020）引入的近似器进行估计。近似器定义如下：</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>D</mi><mtext>KL</mtext></msub><mo stretchy="false">[</mo><msub><mi>π</mi><mi>θ</mi></msub><mo>∥</mo><msub><mi>π</mi><mtext>ref</mtext></msub><mo stretchy="false">]</mo><mo>=</mo><mfrac><mrow><msub><mi>π</mi><mtext>ref</mtext></msub><mo stretchy="false">(</mo><msub><mi>o</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>t</mi></mrow></msub><mo>∣</mo><mi>q</mi><mo separator="true">,</mo><msub><mi>o</mi><mrow><mi>i</mi><mo separator="true">,</mo><mo>&lt;</mo><mi>t</mi></mrow></msub><mo stretchy="false">)</mo></mrow><mrow><msub><mi>π</mi><mi>θ</mi></msub><mo stretchy="false">(</mo><msub><mi>o</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>t</mi></mrow></msub><mo>∣</mo><mi>q</mi><mo separator="true">,</mo><msub><mi>o</mi><mrow><mi>i</mi><mo separator="true">,</mo><mo>&lt;</mo><mi>t</mi></mrow></msub><mo stretchy="false">)</mo></mrow></mfrac><mo>−</mo><mi>log</mi><mo>⁡</mo><mfrac><mrow><msub><mi>π</mi><mtext>ref</mtext></msub><mo stretchy="false">(</mo><msub><mi>o</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>t</mi></mrow></msub><mo>∣</mo><mi>q</mi><mo separator="true">,</mo><msub><mi>o</mi><mrow><mi>i</mi><mo separator="true">,</mo><mo>&lt;</mo><mi>t</mi></mrow></msub><mo stretchy="false">)</mo></mrow><mrow><msub><mi>π</mi><mi>θ</mi></msub><mo stretchy="false">(</mo><msub><mi>o</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>t</mi></mrow></msub><mo>∣</mo><mi>q</mi><mo separator="true">,</mo><msub><mi>o</mi><mrow><mi>i</mi><mo separator="true">,</mo><mo>&lt;</mo><mi>t</mi></mrow></msub><mo stretchy="false">)</mo></mrow></mfrac><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex"> D_{\text{KL}}[\pi_\theta \parallel \pi_{\text{ref}}] = \frac{\pi_{\text{ref}}(o_{i,t} \mid q, o_{i,&lt;t})}{\pi_\theta(o_{i,t} \mid q, o_{i,&lt;t})} - \log \frac{\pi_{\text{ref}}(o_{i,t} \mid q, o_{i,&lt;t})}{\pi_\theta(o_{i,t} \mid q, o_{i,&lt;t})} - 1 </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">KL</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">π</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∥</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">π</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">ref</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.3991em;vertical-align:-0.9721em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">π</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∣</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mrel mtight">&lt;</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">π</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">ref</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∣</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mrel mtight">&lt;</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9721em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:2.3991em;vertical-align:-0.9721em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">π</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∣</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mrel mtight">&lt;</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">π</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">ref</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∣</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mrel mtight">&lt;</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9721em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span></span></p><h3 id="_2-4-计算损失-computing-the-loss" tabindex="-1"><a class="header-anchor" href="#_2-4-计算损失-computing-the-loss" aria-hidden="true">#</a> 2.4. 计算损失 Computing the loss</h3><p>目标是最大化优势值，同时确保模型保持接近参考策略 Ref Policy。因此，损失函数定义如下：</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>L</mi><mtext>GRPO</mtext></msub><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo><mo>=</mo><mo>−</mo><mfrac><mn>1</mn><mi>G</mi></mfrac><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>G</mi></munderover><mfrac><mn>1</mn><mrow><mi mathvariant="normal">∣</mi><msub><mi>o</mi><mi>i</mi></msub><mi mathvariant="normal">∣</mi></mrow></mfrac><munderover><mo>∑</mo><mrow><mi>t</mi><mo>=</mo><mn>1</mn></mrow><mrow><mi mathvariant="normal">∣</mi><msub><mi>o</mi><mi>i</mi></msub><mi mathvariant="normal">∣</mi></mrow></munderover><mrow><mo fence="true">[</mo><mfrac><mrow><msub><mi>π</mi><mi>θ</mi></msub><mo stretchy="false">(</mo><msub><mi>o</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>t</mi></mrow></msub><mo>∣</mo><mi>q</mi><mo separator="true">,</mo><msub><mi>o</mi><mrow><mi>i</mi><mo separator="true">,</mo><mo>&lt;</mo><mi>t</mi></mrow></msub><mo stretchy="false">)</mo></mrow><mrow><mo stretchy="false">[</mo><msub><mi>π</mi><mi>θ</mi></msub><mo stretchy="false">(</mo><msub><mi>o</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>t</mi></mrow></msub><mo>∣</mo><mi>q</mi><mo separator="true">,</mo><msub><mi>o</mi><mrow><mi>i</mi><mo separator="true">,</mo><mo>&lt;</mo><mi>t</mi></mrow></msub><mo stretchy="false">)</mo><msub><mo stretchy="false">]</mo><mtext>no grad</mtext></msub></mrow></mfrac><msub><mover accent="true"><mi>A</mi><mo>^</mo></mover><mrow><mi>i</mi><mo separator="true">,</mo><mi>t</mi></mrow></msub><mo>−</mo><mi>β</mi><msub><mi>D</mi><mtext>KL</mtext></msub><mo stretchy="false">[</mo><msub><mi>π</mi><mi>θ</mi></msub><mo>∥</mo><msub><mi>π</mi><mtext>ref</mtext></msub><mo stretchy="false">]</mo><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex"> L_{\text{GRPO}}(\theta) = -\frac{1}{G} \sum_{i=1}^G \frac{1}{|o_i|} \sum_{t=1}^{|o_i|} \left[ \frac{\pi_\theta(o_{i,t} \mid q, o_{i,&lt;t})}{[\pi_\theta(o_{i,t} \mid q, o_{i,&lt;t})]_{\text{no grad}}} \hat{A}_{i,t} - \beta D_{\text{KL}}[\pi_\theta \parallel \pi_{\text{ref}}] \right] </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">GRPO</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:3.2387em;vertical-align:-1.2777em;"></span><span class="mord">−</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">G</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">G</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">∣</span><span class="mord"><span class="mord mathnormal">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.961em;"><span style="top:-1.8829em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.386em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">∣</span><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mord mtight">∣</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2671em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">[</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">π</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∣</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mrel mtight">&lt;</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose"><span class="mclose">]</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">no grad</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">π</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∣</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mrel mtight">&lt;</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9721em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9468em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">A</span></span><span style="top:-3.2523em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1111em;"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">KL</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">π</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∥</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">π</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">ref</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">]</span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span></span></span></span></span></p><p>其中，第一项表示缩放后的优势值，第二项表示通过KL散度惩罚偏离参考策略的行为。</p><h2 id="_3-采用-easyr1-的-grpo-训练代码实现" tabindex="-1"><a class="header-anchor" href="#_3-采用-easyr1-的-grpo-训练代码实现" aria-hidden="true">#</a> 3. 采用 EasyR1 的 GRPO 训练代码实现</h2><h3 id="_3-1-grpo-训练-examples-qwen2-5-vl-3b-geo3k-grpo-sh" tabindex="-1"><a class="header-anchor" href="#_3-1-grpo-训练-examples-qwen2-5-vl-3b-geo3k-grpo-sh" aria-hidden="true">#</a> 3.1. GRPO 训练：examples/qwen2_5_vl_3b_geo3k_grpo.sh</h3><ul><li>change注释为更改的地方</li><li>如果此处 python3 -m verl.trainer.main 命令行后 和 examples/config.yaml 有同样的配置项，这里的会覆盖 examples/config.yaml 中的配置</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">set</span> <span class="token parameter variable">-x</span>

<span class="token builtin class-name">export</span> <span class="token assign-left variable">VLLM_ATTENTION_BACKEND</span><span class="token operator">=</span>XFORMERS <span class="token comment"># change</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">VLLM_USE_V1</span><span class="token operator">=</span><span class="token number">0</span> <span class="token comment"># change</span>

<span class="token assign-left variable">RAY_PORT</span><span class="token operator">=</span><span class="token number">6379</span> <span class="token comment"># change</span>
<span class="token assign-left variable">DASHBOARD_PORT</span><span class="token operator">=</span><span class="token number">8297</span> <span class="token comment"># change</span>

<span class="token assign-left variable">MODEL_PATH</span><span class="token operator">=</span>Qwen/Qwen2.5-VL-3B-Instruct  <span class="token comment"># replace it with your local file path</span>

<span class="token assign-left variable">SYSTEM_PROMPT</span><span class="token operator">=</span><span class="token string">&quot;&quot;</span>&quot;You FIRST think about the reasoning process as an internal monologue and <span class="token keyword">then</span> provide the final answer.
 The reasoning process MUST BE enclosed within <span class="token operator">&lt;</span>think<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>/think<span class="token operator">&gt;</span> tags. The final answer MUST BE put <span class="token keyword">in</span> <span class="token punctuation">\</span>boxed<span class="token punctuation">{</span><span class="token punctuation">}</span>.<span class="token string">&quot;&quot;</span>&quot;

python3 <span class="token parameter variable">-m</span> verl.trainer.main <span class="token punctuation">\</span>
    <span class="token assign-left variable">config</span><span class="token operator">=</span>examples/config.yaml <span class="token punctuation">\</span>
    <span class="token assign-left variable">data.train_files</span><span class="token operator">=</span>hiyouga/geometry3k@train <span class="token punctuation">\</span>
    <span class="token assign-left variable">data.val_files</span><span class="token operator">=</span>hiyouga/geometry3k@test <span class="token punctuation">\</span>
    <span class="token assign-left variable">data.system_prompt</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${SYSTEM_PROMPT}</span>&quot;</span> <span class="token punctuation">\</span> 
    <span class="token assign-left variable">worker.actor.model.model_path</span><span class="token operator">=</span><span class="token variable">${MODEL_PATH}</span> <span class="token punctuation">\</span>
    <span class="token assign-left variable">worker.rollout.tensor_parallel_size</span><span class="token operator">=</span><span class="token number">1</span> <span class="token punctuation">\</span>
    <span class="token assign-left variable">trainer.experiment_name</span><span class="token operator">=</span>qwen2_5_vl_3b_geo_grpo <span class="token punctuation">\</span>
    <span class="token assign-left variable">trainer.n_gpus_per_node</span><span class="token operator">=</span><span class="token number">8</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2-配置文件-examples-config-yaml" tabindex="-1"><a class="header-anchor" href="#_3-2-配置文件-examples-config-yaml" aria-hidden="true">#</a> 3.2. 配置文件：examples/config.yaml</h3><ul><li>change注释为更改的地方</li></ul><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">data</span><span class="token punctuation">:</span>
  <span class="token key atrule">train_files</span><span class="token punctuation">:</span> hiyouga/math12k@train
  <span class="token key atrule">val_files</span><span class="token punctuation">:</span> hiyouga/math12k@test
  <span class="token key atrule">prompt_key</span><span class="token punctuation">:</span> problem
  <span class="token key atrule">answer_key</span><span class="token punctuation">:</span> answer
  <span class="token key atrule">image_key</span><span class="token punctuation">:</span> images
  <span class="token key atrule">max_prompt_length</span><span class="token punctuation">:</span> <span class="token number">2048</span>
  <span class="token key atrule">max_response_length</span><span class="token punctuation">:</span> <span class="token number">2096</span> <span class="token comment"># change</span>
  <span class="token key atrule">rollout_batch_size</span><span class="token punctuation">:</span> <span class="token number">256</span> <span class="token comment"># change</span>
  <span class="token key atrule">val_batch_size</span><span class="token punctuation">:</span> <span class="token number">-1</span>
  <span class="token key atrule">shuffle</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">seed</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">max_pixels</span><span class="token punctuation">:</span> <span class="token number">2097152</span> <span class="token comment"># change</span>
  <span class="token key atrule">min_pixels</span><span class="token punctuation">:</span> <span class="token number">262144</span>

<span class="token key atrule">algorithm</span><span class="token punctuation">:</span>
  <span class="token key atrule">adv_estimator</span><span class="token punctuation">:</span> grpo
  <span class="token key atrule">disable_kl</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token key atrule">use_kl_loss</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">kl_penalty</span><span class="token punctuation">:</span> low_var_kl
  <span class="token key atrule">kl_coef</span><span class="token punctuation">:</span> <span class="token number">1.0e-2</span>

<span class="token key atrule">worker</span><span class="token punctuation">:</span>
  <span class="token key atrule">actor</span><span class="token punctuation">:</span>
    <span class="token key atrule">global_batch_size</span><span class="token punctuation">:</span> <span class="token number">64</span> <span class="token comment"># change</span>
    <span class="token key atrule">micro_batch_size_per_device_for_update</span><span class="token punctuation">:</span> <span class="token number">2</span> <span class="token comment"># change</span>
    <span class="token key atrule">micro_batch_size_per_device_for_experience</span><span class="token punctuation">:</span> <span class="token number">8</span> <span class="token comment"># change</span>
    <span class="token key atrule">max_grad_norm</span><span class="token punctuation">:</span> <span class="token number">1.0</span>
    <span class="token key atrule">padding_free</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">ulysses_sequence_parallel_size</span><span class="token punctuation">:</span> <span class="token number">1</span>
    <span class="token key atrule">model</span><span class="token punctuation">:</span>
      <span class="token key atrule">model_path</span><span class="token punctuation">:</span> Qwen/Qwen2.5<span class="token punctuation">-</span>7B<span class="token punctuation">-</span>Instruct
      <span class="token key atrule">enable_gradient_checkpointing</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
      <span class="token key atrule">trust_remote_code</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
      <span class="token key atrule">freeze_vision_tower</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token key atrule">optim</span><span class="token punctuation">:</span>
      <span class="token key atrule">lr</span><span class="token punctuation">:</span> <span class="token number">1.0e-6</span>
      <span class="token key atrule">weight_decay</span><span class="token punctuation">:</span> <span class="token number">1.0e-2</span>
      <span class="token key atrule">strategy</span><span class="token punctuation">:</span> adamw  <span class="token comment"># {adamw, adamw_bf16}</span>
      <span class="token key atrule">lr_warmup_ratio</span><span class="token punctuation">:</span> <span class="token number">0.0</span>
    <span class="token key atrule">fsdp</span><span class="token punctuation">:</span>
      <span class="token key atrule">enable_full_shard</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
      <span class="token key atrule">enable_cpu_offload</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
      <span class="token key atrule">enable_rank0_init</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">offload</span><span class="token punctuation">:</span> <span class="token comment"># change</span>
      <span class="token key atrule">offload_params</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>  <span class="token comment"># true: more CPU memory; false: more GPU memory</span>
      <span class="token key atrule">offload_optimizer</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>  <span class="token comment"># true: more CPU memory; false: more GPU memory</span>

  <span class="token key atrule">rollout</span><span class="token punctuation">:</span>
    <span class="token key atrule">temperature</span><span class="token punctuation">:</span> <span class="token number">1.0</span>
    <span class="token key atrule">n</span><span class="token punctuation">:</span> <span class="token number">6</span> <span class="token comment"># change</span>
    <span class="token key atrule">gpu_memory_utilization</span><span class="token punctuation">:</span> <span class="token number">0.7</span> <span class="token comment"># change</span>
    <span class="token key atrule">enforce_eager</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token key atrule">enable_chunked_prefill</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token key atrule">tensor_parallel_size</span><span class="token punctuation">:</span> <span class="token number">2</span>
    <span class="token key atrule">limit_images</span><span class="token punctuation">:</span> <span class="token number">1</span> <span class="token comment"># change</span>
    <span class="token key atrule">val_override_config</span><span class="token punctuation">:</span>
      <span class="token key atrule">temperature</span><span class="token punctuation">:</span> <span class="token number">0.2</span> <span class="token comment"># change</span>
      <span class="token key atrule">n</span><span class="token punctuation">:</span> <span class="token number">1</span>

  <span class="token key atrule">ref</span><span class="token punctuation">:</span>
    <span class="token key atrule">fsdp</span><span class="token punctuation">:</span>
      <span class="token key atrule">enable_full_shard</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
      <span class="token key atrule">enable_cpu_offload</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>  <span class="token comment"># true: more CPU memory; false: more GPU memory # change</span>
      <span class="token key atrule">enable_rank0_init</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">offload</span><span class="token punctuation">:</span>
      <span class="token key atrule">offload_params</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>

  <span class="token key atrule">reward</span><span class="token punctuation">:</span>
    <span class="token key atrule">reward_type</span><span class="token punctuation">:</span> function
    <span class="token key atrule">compute_score</span><span class="token punctuation">:</span> math

<span class="token key atrule">trainer</span><span class="token punctuation">:</span>
  <span class="token key atrule">total_episodes</span><span class="token punctuation">:</span> <span class="token number">15</span> <span class="token comment"># change</span>
  <span class="token key atrule">logger</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;console&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;wandb&quot;</span><span class="token punctuation">]</span>
  <span class="token key atrule">project_name</span><span class="token punctuation">:</span> easy_r1
  <span class="token key atrule">experiment_name</span><span class="token punctuation">:</span> qwen2_5_7b_math_grpo
  <span class="token key atrule">n_gpus_per_node</span><span class="token punctuation">:</span> <span class="token number">8</span>
  <span class="token key atrule">nnodes</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">val_freq</span><span class="token punctuation">:</span> <span class="token number">5</span>  <span class="token comment"># -1 to disable</span>
  <span class="token key atrule">val_before_train</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">val_only</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token key atrule">val_generations_to_log</span><span class="token punctuation">:</span> <span class="token number">1</span> <span class="token comment"># change</span>
  <span class="token key atrule">save_freq</span><span class="token punctuation">:</span> <span class="token number">5</span>  <span class="token comment"># -1 to disable</span>
  <span class="token key atrule">save_limit</span><span class="token punctuation">:</span> <span class="token number">3</span>  <span class="token comment"># -1 to disable</span>
  <span class="token key atrule">save_checkpoint_path</span><span class="token punctuation">:</span> <span class="token null important">null</span>
  <span class="token key atrule">load_checkpoint_path</span><span class="token punctuation">:</span> <span class="token null important">null</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-入口点-verl-trainer-main-py" tabindex="-1"><a class="header-anchor" href="#_3-3-入口点-verl-trainer-main-py" aria-hidden="true">#</a> 3.3. 入口点：verl.trainer.main.py</h3><ul><li>1.合并配置 <ul><li>先将默认配置与配置文件中的配置进行合并</li><li>再将上一部合并的配置与命令行中的配置进行合并</li></ul></li><li>2.初始化 ray (如果 ray 没有初始化) <ul><li>ray.init(runtime_env={&quot;env_vars&quot;: {&quot;TOKENIZERS_PARALLELISM&quot;: &quot;true&quot;, &quot;NCCL_DEBUG&quot;: &quot;WARN&quot;}})</li></ul></li><li>3.让 ray 来执行 runner.run <ul><li>ray.get(runner.run.remote(ppo_config))</li></ul></li><li>4.实例化 trainer 并执行训练</li></ul><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>trainer <span class="token operator">=</span> RayPPOTrainer<span class="token punctuation">(</span>
    config<span class="token operator">=</span>config<span class="token punctuation">,</span>
    tokenizer<span class="token operator">=</span>tokenizer<span class="token punctuation">,</span>
    processor<span class="token operator">=</span>processor<span class="token punctuation">,</span>
    role_worker_mapping<span class="token operator">=</span>role_worker_mapping<span class="token punctuation">,</span>
    resource_pool_manager<span class="token operator">=</span>resource_pool_manager<span class="token punctuation">,</span>
    ray_worker_group_cls<span class="token operator">=</span>ray_worker_group_cls<span class="token punctuation">,</span>
    reward_fn<span class="token operator">=</span>reward_fn<span class="token punctuation">,</span>
    val_reward_fn<span class="token operator">=</span>val_reward_fn<span class="token punctuation">,</span>
<span class="token punctuation">)</span>
trainer<span class="token punctuation">.</span>init_workers<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># Init resource pool and worker group</span>
trainer<span class="token punctuation">.</span>fit<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># The training loop of PPO</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-4-trainer-fit" tabindex="-1"><a class="header-anchor" href="#_3-4-trainer-fit" aria-hidden="true">#</a> 3.4. trainer.fit()</h3><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">RayPPOTrainer</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">fit</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> _ <span class="token keyword">in</span> tqdm<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>config<span class="token punctuation">.</span>trainer<span class="token punctuation">.</span>total_episodes<span class="token punctuation">)</span><span class="token punctuation">,</span> desc<span class="token operator">=</span><span class="token string">&quot;Episode&quot;</span><span class="token punctuation">,</span> position<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> batch_dict <span class="token keyword">in</span> tqdm<span class="token punctuation">(</span>self<span class="token punctuation">.</span>train_dataloader<span class="token punctuation">,</span> desc<span class="token operator">=</span><span class="token string">&quot;Running step&quot;</span><span class="token punctuation">,</span> position<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token comment"># generate sequences</span>
                gen_batch_output <span class="token operator">=</span> self<span class="token punctuation">.</span>actor_rollout_wg<span class="token punctuation">.</span>generate_sequences<span class="token punctuation">(</span>gen_batch<span class="token punctuation">)</span>
                <span class="token comment"># compute reward</span>
                reward_tensor<span class="token punctuation">,</span> reward_metrics <span class="token operator">=</span> self<span class="token punctuation">.</span>reward_fn<span class="token punctuation">(</span>batch<span class="token punctuation">)</span>
                batch<span class="token punctuation">.</span>batch<span class="token punctuation">[</span><span class="token string">&quot;token_level_scores&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> reward_tensor
                reward_metrics <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string-interpolation"><span class="token string">f&quot;reward/</span><span class="token interpolation"><span class="token punctuation">{</span>key<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">:</span> value <span class="token keyword">for</span> key<span class="token punctuation">,</span> value <span class="token keyword">in</span> reduce_metrics<span class="token punctuation">(</span>reward_metrics<span class="token punctuation">)</span><span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
                <span class="token comment"># recompute old_log_probs</span>
                old_log_probs <span class="token operator">=</span> self<span class="token punctuation">.</span>actor_rollout_wg<span class="token punctuation">.</span>compute_log_probs<span class="token punctuation">(</span>batch<span class="token punctuation">)</span>
                <span class="token comment"># compute ref_log_probs</span>
                ref_log_probs <span class="token operator">=</span> self<span class="token punctuation">.</span>ref_policy_wg<span class="token punctuation">.</span>compute_ref_log_probs<span class="token punctuation">(</span>batch<span class="token punctuation">)</span>
                batch<span class="token punctuation">.</span>batch<span class="token punctuation">[</span><span class="token string">&quot;token_level_rewards&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> batch<span class="token punctuation">.</span>batch<span class="token punctuation">[</span><span class="token string">&quot;token_level_scores&quot;</span><span class="token punctuation">]</span>
                <span class="token comment"># compute advantages</span>
                batch <span class="token operator">=</span> compute_advantage<span class="token punctuation">(</span>
                    batch<span class="token punctuation">,</span>
                    adv_estimator<span class="token operator">=</span>self<span class="token punctuation">.</span>config<span class="token punctuation">.</span>algorithm<span class="token punctuation">.</span>adv_estimator<span class="token punctuation">,</span>
                    gamma<span class="token operator">=</span>self<span class="token punctuation">.</span>config<span class="token punctuation">.</span>algorithm<span class="token punctuation">.</span>gamma<span class="token punctuation">,</span>
                    lam<span class="token operator">=</span>self<span class="token punctuation">.</span>config<span class="token punctuation">.</span>algorithm<span class="token punctuation">.</span>lam<span class="token punctuation">,</span>
                <span class="token punctuation">)</span>
                <span class="token comment"># update actor</span>
                actor_output <span class="token operator">=</span> self<span class="token punctuation">.</span>actor_rollout_wg<span class="token punctuation">.</span>update_actor<span class="token punctuation">(</span>batch<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-实操记录-grpo-训练细节" tabindex="-1"><a class="header-anchor" href="#_4-实操记录-grpo-训练细节" aria-hidden="true">#</a> 4. 实操记录 GRPO 训练细节</h2><h3 id="_4-1-关键数据信息" tabindex="-1"><a class="header-anchor" href="#_4-1-关键数据信息" aria-hidden="true">#</a> 4.1. 关键数据信息</h3><ul><li>train_dataset: 2100（训练数据集2100条数据）</li><li>val_dataset: 300（验证数据集300条数据）</li><li>max_prompt_len: 2048（Prompt最大长度为2048个token）</li><li>max_resp_len: 2096（Completion最大长度为2096个token）</li><li>max_total_len: 4144 （Prompt和Completion总的最大长度为4144个token） <ul><li>（max_total_len = max_prompt_len + max_resp_len = 2048 + 2096 = 4144）</li></ul></li><li>total_episodes: 15（总的轮数Epochs为15轮）</li><li>rollout_batch_size: 256 (256条数据作为一个rollout批次)</li><li>rollout_n: 6 (每条数据生成序列个数为6)</li><li>rollout_batch_size * rollout_n = 256 * 6 = 1536 (一个rollout批次处理1536个序列的生成)</li><li>nnodes: 1 （节点个数为1）</li><li>n_gpus_per_node: 8 （每个节点的GPU数为8）</li><li>world_size = nnodes * n_gpus_per_node = 1 * 8 = 8 （并发度world_size为8）</li><li>(rollout_batch_size * rollout_n) / (nnodes * n_gpus_per_node) = 256 * 6 / 8 = 192 （每个GPU上要处理192个token序列）</li><li>global_batch_size: 64 (全局批次大小为64，也就是64个序列进行一次更新)</li><li>global_batch_size_per_device = global_batch_size * rollout_n / world_size = 64 * 6 / 8 = 48 （每个GPU的全局批次大小）</li><li>mini_batches = nums_per_rank / global_batch_size_per_device = 192/ 48 = 4 （每个rollout批次的处理，分成4次进行更新）</li><li>micro_batch_size_per_device_for_experience: 8 （每个GPU的处理微批次为8）</li><li>micro_batch_size_per_device_for_update: 2 （每个GPU上的更新微批次为2）</li></ul><h3 id="_4-2-训练细节" tabindex="-1"><a class="header-anchor" href="#_4-2-训练细节" aria-hidden="true">#</a> 4.2. 训练细节</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>- episodes <span class="token number">15</span> （15个Epochs）
    - steps <span class="token number">8</span> <span class="token punctuation">(</span>train_dataset / rollout_batch_size <span class="token operator">=</span>  <span class="token number">2100</span> / <span class="token number">256</span> <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">)</span> （数据集的每256条数据作为一个rollout批次，每个Epochs分为8个steps）
        - batch_dict
            - batch_dict.keys<span class="token punctuation">(</span><span class="token punctuation">)</span>: <span class="token punctuation">[</span><span class="token string">&#39;input_ids&#39;</span>, <span class="token string">&#39;attention_mask&#39;</span>, <span class="token string">&#39;position_ids&#39;</span>, <span class="token string">&#39;problem&#39;</span>, <span class="token string">&#39;id&#39;</span>, <span class="token string">&#39;choices&#39;</span>, <span class="token string">&#39;ground_truth&#39;</span>, <span class="token string">&#39;multi_modal_data&#39;</span>, <span class="token string">&#39;multi_modal_inputs&#39;</span>, <span class="token string">&#39;raw_prompt_ids&#39;</span><span class="token punctuation">]</span>
            - batch_dict<span class="token punctuation">[</span><span class="token string">&#39;input_ids&#39;</span><span class="token punctuation">]</span>.shape: <span class="token punctuation">(</span>rollout_batch_size, max_prompt_len<span class="token punctuation">)</span> 
                - <span class="token punctuation">[</span><span class="token number">256</span>, <span class="token number">2048</span><span class="token punctuation">]</span>
        - nums_per_step <span class="token number">1536</span> <span class="token punctuation">(</span>rollout_batch_size * rollout_n <span class="token operator">=</span> <span class="token number">256</span> * <span class="token number">6</span> <span class="token operator">=</span> <span class="token number">1536</span><span class="token punctuation">)</span>（一个rollout批次有256条数据，每条数据生成6个序列，共要处理1536个token序列）
            - nums_per_rank <span class="token number">192</span> <span class="token punctuation">(</span>rollout_batch_size * rollout_n / world_size <span class="token operator">=</span> <span class="token number">1536</span> / <span class="token number">8</span> <span class="token operator">=</span> <span class="token number">192</span><span class="token punctuation">)</span> （共8个GPU，每个GPU上要处理192个token序列）
                - generate sequences 生成序列
                - compute reward 计算奖励
                    - reward_tensor, reward_metrics <span class="token operator">=</span> self.reward_fn<span class="token punctuation">(</span>batch<span class="token punctuation">)</span>
                    - batch.batch<span class="token punctuation">[</span><span class="token string">&quot;token_level_scores&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> reward_tensor<span class="token comment"># 每个token的得分，（每个token对应一个得分，boxed{x}那个作为答案的位置的token得分大于0，其余token等于0）</span>
                    - reward_metrics: <span class="token punctuation">{</span><span class="token string">&#39;reward/overall&#39;</span><span class="token builtin class-name">:</span> x1, <span class="token string">&#39;reward/format&#39;</span><span class="token builtin class-name">:</span> x2, <span class="token string">&#39;reward/accuracy&#39;</span><span class="token builtin class-name">:</span> x3<span class="token punctuation">}</span>
                - Compute log probs 
                    - <span class="token number">24</span> <span class="token punctuation">(</span>nums_per_rank / micro_batch_size_per_device_for_experience <span class="token operator">=</span> <span class="token number">192</span> / <span class="token number">8</span> <span class="token operator">=</span> <span class="token number">24</span><span class="token punctuation">)</span> 计算每个补全token序列的概率估计，每个token都对应一个概率，有2096维度（每个GPU的处理微批次为8，进行24次处理）
                    - compute old_log_probs <span class="token operator">&amp;</span> compute ref_log_probs
                        - compute old_log_probs 计算老的actor model<span class="token punctuation">(</span>本轮还未更新的<span class="token punctuation">)</span>在此batch上的log_probs
                        - compute ref_log_probs 计算ref model的log_probs
        - 聚合 log prob
            - <span class="token punctuation">[</span><span class="token number">1536</span>, <span class="token number">2096</span><span class="token punctuation">]</span> （聚合rollout批次的log prob数据）
        - compute advantage 计算优势值
            - 计算每个补全token序列的得分
                - <span class="token punctuation">[</span><span class="token number">1536</span><span class="token punctuation">]</span> 
                - scores <span class="token operator">=</span> token_level_scores.sum<span class="token punctuation">(</span>-1<span class="token punctuation">)</span> 每个token得分之和为最终得分
            - 计算每组的均值和标准差 
                - id2mean，id2std 
                - rollout_n个uid是一样的，用来计算均值和标准差
            - 计算组内相对优势 
                - <span class="token punctuation">[</span><span class="token number">1536</span><span class="token punctuation">]</span> 
                - scores<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>scores<span class="token punctuation">[</span>i<span class="token punctuation">]</span> - id2mean<span class="token punctuation">[</span>index<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> / <span class="token punctuation">(</span>id2std<span class="token punctuation">[</span>index<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> + eps<span class="token punctuation">)</span>
            - <span class="token punctuation">[</span><span class="token number">1536,2096</span><span class="token punctuation">]</span> <span class="token number">2096</span>维度的值都一样，都为组内相对优势计算出的值
        - update actor（actor model <span class="token operator">==</span> policy model）
            - 计算 mini_batches （如果rollout_batch_size<span class="token operator">==</span>global_batch_size的话，mini_batches为1）
                - nums_per_rank <span class="token number">192</span>
                - global_batch_size <span class="token number">64</span>
                - global_batch_size_per_device <span class="token operator">=</span> global_batch_size * rollout_n / world_size <span class="token operator">=</span> <span class="token number">64</span> * <span class="token number">6</span> / <span class="token number">8</span> <span class="token operator">=</span> <span class="token number">48</span>
                - mini_batches <span class="token operator">=</span> nums_per_rank / global_batch_size_per_device <span class="token operator">=</span> <span class="token number">192</span> / <span class="token number">48</span> <span class="token operator">=</span> <span class="token number">4</span>
            - Train mini batch（4）
                - 一个mini_batch更新一次参数
                - 一个mini_batch每个GPU处理48条数据，每micro_batch为2进行反向传播计算梯度，进行了24次的梯度累积
                - gradient_accumulation <span class="token number">24</span> 
                    - gradient_accumulation <span class="token operator">=</span> global_batch_size_per_device / micro_batch_size_per_device_for_update <span class="token operator">=</span> <span class="token number">48</span> / <span class="token number">2</span> <span class="token operator">=</span> <span class="token number">24</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!--[--><!----><!--]--><footer class="page-meta"><!----><div class="meta-item git-info"><!----><!----></div></footer><nav class="vp-page-nav"><!----><a aria-label="SFTTrainer 源码解读: Prepare Train" class="vp-link nav-link next nav-link next" href="/blog/zh/posts/llm/034_sft_trainer_sourcecode_prepare_train.html"><div class="hint">下一页<span class="arrow end"></span></div><div class="link">SFTTrainer 源码解读: Prepare Train<span class="font-icon icon fa-fw fa-sm fas fa-lightbulb" style=""></span></div></a></nav><!----><!--[--><!----><!--]--><!--]--></main><!--]--><!----></div><!--]--><!--]--><!----><!--]--></div>
    <script type="module" src="/blog/assets/app-fhreafr2.js" defer></script>
  </body>
</html>
